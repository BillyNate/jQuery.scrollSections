/* ------------------------------------------------------------------------------------------------------
| jQuery Scrollsections Plugin
| -------------------------------------------------------------------------------------------------------
| 
| A plugin that allow you to define (full page) sections and scroll between them with mousewheel,keyboard,scrollbar and touchmouves
|
| /!\ REQUIRES : MouseWheel jQuery Plugin, https://github.com/brandonaaron/jquery-mousewheel 
| /!\ REQUIRES : jQuery Special Events scrollstart & scrollstop, http://james.padolsey.com/demos/scrollevents/ 
|
| Version : 0.2
| author : Stéphane Guigné (http://stephaneguigne.com)
|
*/
;(function(a){a.fn.scrollsections=function(b){function t(){var a=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(a.exec(window.navigator.userAgent)!=null&&parseFloat(RegExp.$1)<=8)s=true;x();if(d.createNavigation)u();if(d.initOnFirstSection&&!d.initOnChosenSection)C();else if(d.initOnChosenSection)D(d.initOnChosenSection);e.bind("resize.scrollsections",function(){F(m)})}function u(){r=a("<nav>").attr("id",d.prefixName+"-navigation");for(var b=0;b<h;b++){$link=a("<a>").attr("id",d.prefixName+"-link-"+b).addClass(d.prefixName+"-link").data(d.prefixName,{sectionPosition:b}).html("Section "+b);r.append($link)}g.append(r);if(d.navigationPosition)v(d.navigationPosition);w(true)}function v(a){var b={};switch(a){case"r"||"right":b={marginTop:-r.outerHeight()/2+"px"};break}r.css(b)}function w(b){var c=a("."+d.prefixName+"-link",r),e=d.prefixName+"-link-current";if(b){c.bind("click",function(b){b.preventDefault(d.prefixName);var c=a(this),e=c.data(),f=e[d.prefixName]["sectionPosition"];F(f)})}c.removeClass(e);c.each(function(){var b=a(this),c=b.data(),f=c[d.prefixName]["sectionPosition"];if(m==f){b.addClass(e);return false}})}function x(){if(d.bindScrollBar)y();if(d.bindMousewheel&&!s)z();if(d.bindKeyboard)A();if(d.bindTouchMoves)B()}function y(){e.bind("scrollstop.scrollsections",function(a){var b=f.scrollTop()||e.scrollTop(),c=f.outerHeight(),d;if(b==0&&m!=0){d=0}else if(b==(h-1)*e.height()&&m!=h-1){d=h-1}else{for(var g=0;g<h;g++){var j=i[g],k=j.offset().top,l=Math.abs(b-k);if(!c||l<=c){c=l;d=g;if(c==0)return}}}if(d>-1)F(d)})}function z(){var a,b=-1;e.bind("scrollstop.scrollsections",function(a){q=null});e.bind("mousewheel",function(c,e,f,g){c.preventDefault();var i=g>>0;if(!o&&!q){if(g<0){if(i<-d.scrollStepMax)i=-d.scrollStepMax;if(!b||!a||i<a){if(m-i<h){a=i;b=m-a}}}else{if(i>d.scrollStepMax)i=d.scrollStepMax;if(!b||!a||i>a){if(m-i>-1){a=i;b=m-a}}}if(a&&b>-1){if(p)clearTimeout(p);if(Math.abs(a)<d.scrollStepMax){p=setTimeout(function(){F(b);b=null;a=null;p=null;q=true},10)}else{F(b);b=null;a=null;p=null;q=true}}}return false})}function A(){f.bind("keydown.scrollsections",function(a){var b;switch(a.which){case 38:var c=m-1;if(c>=0)F(c);a.preventDefault();return false;break;case 40:var c=m+1;if(c<h)F(c);a.preventDefault();return false;break}})}function B(){g.unbind("touchstart.scrollsections").bind("touchstart.scrollsections",function(a){a.preventDefault();var b={x:a.clientX,y:a.clientY},c={x:a.clientX,y:a.clientY},d,e,f;g.bind("touchmove.scrollsections",function(a){a.preventDefault();c.x=a.clientX;c.y=a.clientY;e=b.x-c.x;d=b.y-c.y;if((d<=-100||d>=100)&&Math.abs(d)>Math.abs(e)){g.unbind("touchmove.LRSlider");var f=d<0?m-1:m+1;F(f)}})}).unbind("touchend.scrollsections").bind("touchend.scrollsections",function(){g.unbind("touchmove.LRSlider")})}function C(){k=setTimeout(function(){F(0,!d.initAnimation)},50)}function D(a){var b;if(!isNaN(a)&&a>=0&&a<h){b=a}else if(isNaN(a)&&j.join(",").indexOf(a)>-1){for(var c=0;c<j.length;c++){if(a==j[c])b=c}}else{return false}if(b){if(k)clearTimeout(k);F(b,!d.initAnimation)}}function E(){o=true;if(d.beforeScrollCallback)d.beforeScrollCallback()}function F(a,b){if(a!=null&&a>=0&&a<h){m=a;l=i[a];var c=l.offset().top,e=b?0:d.animateSpeed;E();w();f.stop(true,false).animate({scrollTop:c},e,function(){G()})}}function G(){o=false;if(d.afterScrollCallback)d.afterScrollCallback()}var c={attr:"id",bindKeyboard:true,bindMousewheel:true,bindTouchMoves:true,bindScrollBar:true,animateSpeed:500,scrollStepMax:1,beforeScrollCallback:null,afterScrollCallback:null,prefixName:"scrollsections",initOnChosenSection:null,initAnimation:false,initOnFirstSection:true,createNavigation:true,navigationPosition:"r",debugMode:false},d,e=a(window),f=a("body, html"),g=a("body"),h=0,i=[],j=[],k=null,l=null,m=0,n=true,o=false,p=null,q=null,r=null,s=false;d=a.extend(c,b);this.each(function(){var b=a(this);if(n){n=false;b.addClass(d.currentClassName);l=b}h++;i.push(b);j.push(b.attr(d.attr))});if(h>0)t();return this}})(jQuery);